# 📊 우선주 가격차이 분석 시스템

한국 주요 기업들의 보통주와 우선주 간 가격 차이를 분석하는 종합적인 도구입니다. 15개 주요 기업의 다양한 기간(3년, 5년, 10년, 20년, 30년)에 걸친 데이터를 분석하고 백테스팅을 수행할 수 있습니다.

## 🌟 주요 기능

### 📈 다중 기업 분석
- **15개 주요 기업** 지원 (삼성전자, LG화학, LG전자, SK하이닉스, 현대자동차 등)
- **8개 업종** 분류 (전자/반도체, 화학, 자동차, 철강, IT서비스 등)
- **자동 배당금 데이터** 수집 및 외부 데이터 통합

### ⚡ 성능 최적화
- **증분 업데이트**: 기존 데이터 활용으로 처리 시간 단축
- **최적화된 분위수 계산**: 슬라이딩 윈도우 방식으로 효율적 처리
- **JSON 캐싱**: 계산 결과 저장으로 재실행 시 빠른 로딩

### 📊 다양한 분석 기간
- **3년, 5년, 10년, 20년, 30년** 데이터 지원
- **2년, 3년, 5년** 슬라이딩 윈도우 분위수 계산
- **일별 가격 차이 비율** 및 **배당 수익률** 분석

### 🎯 백테스팅 시스템
- **매수/매도 전략** 시뮬레이션
- **수익률 계산** 및 **리스크 분석**
- **포트폴리오 성과** 추적

## 🏢 지원하는 기업들

### 전자/반도체
- **삼성전자** (005930.KS / 005935.KS) ✓
- **SK하이닉스** (000660.KS / 000665.KS)

### 화학
- **LG화학** (051910.KS / 051915.KS)
- **롯데케미칼** (011170.KS / 011175.KS)

### 자동차
- **현대자동차** (005380.KS / 005385.KS)
- **기아** (000270.KS / 000275.KS)

### IT서비스
- **NAVER** (035420.KS / 035425.KS)
- **카카오** (035720.KS / 035725.KS)

### 기타 업종
- **LG전자** (전자), **포스코홀딩스** (철강), **SK이노베이션** (에너지/화학)
- **LG생활건강** (생활용품), **한화솔루션** (태양광/화학)
- **CJ제일제당** (식품), **아모레퍼시픽** (화장품)

✓: 배당금 데이터 보유, ○: yfinance 자동 수집

## 🚀 설치 및 설정

### 필수 요구사항
```bash
# Python 3.8 이상
python --version

# uv 패키지 매니저 (권장)
pip install uv
```

### 의존성 설치
```bash
# uv 사용 (권장)
uv sync

# 또는 pip 사용
pip install -r requirements.txt
```

### 한글 폰트 설정 (Linux)
```bash
# 나눔고딕 폰트 설치
sudo apt-get update
sudo apt-get install fonts-nanum*
```

## 💻 사용법

### 기본 사용법

#### 1. 모든 회사 분석 (기본값)
```bash
python stock_diff.py
```
- 15개 모든 기업에 대해 5개 기간(3년, 5년, 10년, 20년, 30년) 분석
- 가장 포괄적인 분석 수행

#### 2. 특정 회사 분석
```bash
# 삼성전자만 분석
python stock_diff.py --company 삼성전자

# LG화학만 분석
python stock_diff.py --company LG화학

# 축약형 옵션 사용
python stock_diff.py -c 현대자동차
```

#### 3. 지원 기업 목록 확인
```bash
python stock_diff.py --list
# 또는
python stock_diff.py -l
```

#### 4. 도움말 확인
```bash
python stock_diff.py --help
# 또는
python stock_diff.py -h
```

### uv 사용 (권장)
```bash
# uv를 사용한 실행
uv run python stock_diff.py
uv run python stock_diff.py --company 삼성전자
uv run python stock_diff.py --list
```

## 📁 출력 파일

### 데이터 파일
```
{회사명}_stock_analysis_{기간}.json
```
- **예시**: `삼성전자_stock_analysis_20년.json`
- **내용**: 가격 차이, 비율, 배당금, 분위수 데이터

### 삼성전자 특별 파일 (호환성 유지)
- `samsung_stock_analysis.json`: 기본 20년 데이터
- `price_diff_ratio_distribution.png`: 히스토그램 및 박스 플롯

### 데이터 구조
```json
{
  "24-01-15": {
    "Price_Difference": 1500,
    "Price_Diff_Ratio": 2.5,
    "Dividend_Amount": 361.0,
    "Dividend_Yield_on_Preferred": 0.6,
    "Price_Diff_Ratio_25th_Percentile_2year": 1.8,
    "Price_Diff_Ratio_75th_Percentile_2year": 3.2,
    ...
  }
}
```

## 🔧 고급 기능

### 증분 업데이트
시스템은 자동으로 기존 데이터를 확인하고 새로운 데이터만 다운로드합니다:

```
✓ 기존 데이터 로드 완료: 2022-01-01 ~ 2024-07-31 (945일)
📅 새 데이터 다운로드: 2024-08-01 ~ 2025-08-02
✓ 데이터 병합 완료: 기존 945일 + 새로운 2일 = 총 947일
```

### 분위수 계산
- **2년 윈도우**: 730일 기준 25%, 75% 분위수
- **3년 윈도우**: 1095일 기준 25%, 75% 분위수  
- **5년 윈도우**: 1825일 기준 25%, 75% 분위수

### 배당금 데이터
- **삼성전자**: 2020년~2025년 상세 배당금 데이터 보유
- **기타 기업**: yfinance API 자동 수집

## 📊 분석 결과 해석

### Price_Diff_Ratio
```
Price_Diff_Ratio = (보통주 가격 - 우선주 가격) / 우선주 가격 × 100
```
- **양수**: 보통주가 우선주보다 비쌈 (일반적 상황)
- **음수**: 우선주가 보통주보다 비쌈 (특수 상황)

### 분위수 활용
- **25% 분위수 이하**: 상대적으로 낮은 가격 차이 (매수 기회)
- **75% 분위수 이상**: 상대적으로 높은 가격 차이 (매도 기회)

### 배당 수익률
```
Dividend_Yield = 배당금 / 우선주 가격 × 100
```

## 🔍 문제 해결

### 자주 발생하는 오류

#### 1. 폰트 관련 오류
```bash
# Linux에서 한글 폰트 설치
sudo apt-get install fonts-nanum*

# 설치 후 Python 재시작
```

#### 2. 데이터 다운로드 실패
```bash
# 인터넷 연결 확인
ping finance.yahoo.com

# yfinance 업데이트
pip install --upgrade yfinance
```

#### 3. 메모리 부족
```bash
# 특정 회사만 분석하여 메모리 사용량 줄이기
python stock_diff.py --company 삼성전자
```

### 로그 메시지 해석

#### 성공적인 실행
```
🏢 분석 대상: 삼성전자
📈 보통주: 005930.KS
📊 우선주: 005935.KS
✓ 외부 배당금 데이터 20개 항목 로드
💾 저장 완료: ./삼성전자_stock_analysis_20년.json (총 5234일)
```

#### 증분 업데이트
```
🔄 증분 업데이트 모드: 기존 데이터 활용
📅 새 데이터 다운로드: 2024-08-01 ~ 2025-08-02
💾 업데이트 완료: (2일 추가, 총 5236일)
```

## 📈 백테스팅 활용

본 시스템의 데이터는 별도의 백테스팅 시스템과 연동 가능합니다:

1. **전략 설정**: 분위수 기반 매수/매도 조건
2. **리스크 관리**: 손절매, 익절매 설정
3. **성과 분석**: 수익률, 최대 손실(MDD) 계산
4. **보고서 생성**: 상세한 분석 리포트

## 🛠️ 개발자 정보

### 프로젝트 구조
```
stock_samsung/
├── stock_diff.py              # 메인 분석 스크립트
├── README.md                  # 사용 설명서
├── pyproject.toml            # 프로젝트 설정
├── uv.lock                   # 의존성 잠금 파일
└── *.json                    # 분석 결과 데이터
```

### 주요 함수
- `generate_stock_data_for_periods()`: 기간별 데이터 생성
- `generate_data_for_all_companies()`: 전체 기업 일괄 처리
- `get_stock_data_with_diff_and_dividends()`: 핵심 데이터 처리
- `load_existing_data()`: 증분 업데이트 지원

### 확장 가능성
- 새로운 기업 추가: `PREFERRED_STOCK_COMPANIES` 딕셔너리 수정
- 새로운 분석 기간: `periods` 딕셔너리 수정
- 커스텀 지표: 데이터 처리 함수 확장

## 📞 지원 및 문의

- **이슈 리포팅**: GitHub Issues를 통해 버그 신고
- **기능 요청**: 새로운 기능 아이디어 제안
- **문서 개선**: README 및 주석 개선 제안

## 📝 라이선스

이 프로젝트는 개인 및 교육 목적으로 자유롭게 사용 가능합니다.

---

**⚠️ 주의사항**: 본 도구는 투자 참고용이며, 실제 투자 결정은 신중히 하시기 바랍니다.
