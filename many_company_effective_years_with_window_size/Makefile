# Makefile for running Python scripts with uv

.PHONY: all interactive run-stock-diff run-analyze-ratio run-analyze-all run-backtest-strategy run-get-ltd-dividend run-comprehensive-report run-dividend-compare clean help

# Default target: run all companies analysis
all: run-full-pipeline-all

# Interactive company selection and analysis
interactive:
	@echo "ğŸ¢ ì§€ì›ë˜ëŠ” íšŒì‚¬ ëª©ë¡:"
	@echo ""
	@uv run python -c "from stock_diff import PREFERRED_STOCK_COMPANIES; companies = list(PREFERRED_STOCK_COMPANIES.keys()); [print(f'  {i:2d}. {company}') for i, company in enumerate(companies, 1)]; print('')"
	@echo "ğŸ“ ì‚¬ìš©ë²•:"
	@echo "  - íšŒì‚¬ ë²ˆí˜¸ ì…ë ¥: í•´ë‹¹ íšŒì‚¬ë§Œ ë¶„ì„"
	@echo "  - íšŒì‚¬ ì´ë¦„ ì…ë ¥: í•´ë‹¹ íšŒì‚¬ë§Œ ë¶„ì„"
	@echo "  - Enter (ë¹ˆ ì…ë ¥): ëª¨ë“  íšŒì‚¬ ë¶„ì„"
	@echo ""
	@read -p "ğŸ¯ ë¶„ì„í•  íšŒì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš” (ë²ˆí˜¸/ì´ë¦„/Enter): " choice; \
	if [ -z "$$choice" ]; then \
		echo "ğŸŒ ëª¨ë“  íšŒì‚¬ì— ëŒ€í•œ ì „ì²´ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤..."; \
		$(MAKE) run-full-pipeline-all; \
	elif echo "$$choice" | grep -qE '^[0-9]+$$'; then \
		company=$$(uv run python -c "from stock_diff import PREFERRED_STOCK_COMPANIES; companies = list(PREFERRED_STOCK_COMPANIES.keys()); idx = int('$$choice') - 1; print(companies[idx] if 0 <= idx < len(companies) else '')"); \
		if [ -n "$$company" ]; then \
			echo "ğŸ¯ $$companyì— ëŒ€í•œ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤..."; \
			$(MAKE) run-full-pipeline-company COMPANY="$$company"; \
		else \
			echo "âŒ ì˜ëª»ëœ ë²ˆí˜¸ì…ë‹ˆë‹¤."; \
		fi; \
	else \
		echo "ğŸ¯ $$choiceì— ëŒ€í•œ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤..."; \
		$(MAKE) run-full-pipeline-company COMPANY="$$choice"; \
	fi

# Full pipeline for specific company
run-full-pipeline-company:
	@echo "ğŸš€ $(COMPANY) - ë°ì´í„° ìƒì„± ì¤‘..."
	@$(MAKE) run-stock-diff-company COMPANY="$(COMPANY)"
	@echo ""
	@echo "ğŸ“Š $(COMPANY) - ìƒì„¸ ë¶„ì„ ì¤‘..."
	@$(MAKE) run-analyze-ratio-company COMPANY="$(COMPANY)"
	@echo ""
	@echo "ğŸ’° $(COMPANY) - ë°°ë‹¹ë¥  ë¹„êµ ë¶„ì„ ì¤‘..."
	@$(MAKE) run-dividend-compare-company COMPANY="$(COMPANY)"
	@echo ""
	@echo "ğŸ® $(COMPANY) - ë°±í…ŒìŠ¤íŒ… ì¤‘..."
	@$(MAKE) run-backtest-strategy-company COMPANY="$(COMPANY)"
	@echo ""
	@echo "âœ… $(COMPANY) ë¶„ì„ ì™„ë£Œ!"

# Full pipeline for all companies
run-full-pipeline-all:
	@echo "ğŸš€ ëª¨ë“  íšŒì‚¬ - ë°ì´í„° ìƒì„± ì¤‘..."
	@$(MAKE) run-stock-diff
	@echo ""
	@echo "ğŸ“Š ëª¨ë“  íšŒì‚¬ - ìƒì„¸ ë¶„ì„ ì¤‘..."
	@$(MAKE) run-analyze-ratio
	@echo ""
	@echo "ğŸŒ ëª¨ë“  íšŒì‚¬ - ì¢…í•© ë¹„êµ ë¶„ì„ ì¤‘..."
	@$(MAKE) run-analyze-all
	@echo ""
	@echo "ï¿½ ë°°ë‹¹ë¥  ë¹„êµ ë¶„ì„ ì¤‘..."
	@$(MAKE) run-dividend-compare
	@echo ""
	@echo "ï¿½ğŸ“‹ ì¢…í•© ë¹„êµ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘..."
	@$(MAKE) run-comprehensive-report
	@echo ""
	@echo "ğŸ® ë°±í…ŒìŠ¤íŒ… ì¤‘..."
	@$(MAKE) run-backtest-strategy
	@echo ""
	@echo "âœ… ëª¨ë“  íšŒì‚¬ ë¶„ì„ ì™„ë£Œ!"

# === ì£¼ì‹ ë°ì´í„° ìƒì„± ===

# Run stock_diff.py to generate analysis data (ê¸°ë³¸: ëª¨ë“  íšŒì‚¬)
run-stock-diff:
	@echo "ğŸš€ Running stock_diff.py to generate data for all companies..."
	uv run python stock_diff.py

# Run stock_diff.py for specific company (usage: make run-stock-diff-company COMPANY=ì‚¼ì„±ì „ì)
run-stock-diff-company:
	@echo "ğŸ¯ Running stock_diff.py for $(COMPANY)..."
	uv run python stock_diff.py --company "$(COMPANY)"

# Show supported companies
list-companies:
	@echo "ğŸ“‹ Showing supported companies..."
	uv run python stock_diff.py --list

# === ê°œë³„ íšŒì‚¬ ì‹¬í™” ë¶„ì„ ===

# Run analyze_ratio.py for detailed analysis (ê¸°ë³¸: ëª¨ë“  íšŒì‚¬)
run-analyze-ratio:
	@echo "ğŸ“Š Running detailed analysis with analyze_ratio.py..."
	uv run python analyze_ratio.py

# Run analyze_ratio.py for specific company (usage: make run-analyze-ratio-company COMPANY=LGí™”í•™)
run-analyze-ratio-company:
	@echo "ğŸ¯ Running detailed analysis for $(COMPANY)..."
	uv run python analyze_ratio.py --company "$(COMPANY)"

# Run analyze_ratio.py for single period (usage: make run-analyze-single-period PERIOD=20ë…„)
run-analyze-single-period:
	@echo "ğŸ“Š Running single period analysis..."
	uv run python analyze_ratio.py --period "$(PERIOD)"

# Run analyze_ratio.py for specific company and period (usage: make run-analyze-company-period COMPANY=ì‚¼ì„±ì „ì PERIOD=10ë…„)
run-analyze-company-period:
	@echo "ğŸ¯ Running analysis for $(COMPANY) ($(PERIOD))..."
	uv run python analyze_ratio.py --company "$(COMPANY)" --period "$(PERIOD)"

# Generate timeseries plots (usage: make run-timeseries COMPANY=í˜„ëŒ€ìë™ì°¨)
run-timeseries:
	@echo "ğŸ“ˆ Generating timeseries plots for $(COMPANY)..."
	uv run python analyze_ratio.py --company "$(COMPANY)" --timeseries

# === ë‹¤ì¤‘ íšŒì‚¬ ë¹„êµ ë¶„ì„ ===

# Run analyze_all_companies.py for comprehensive comparison
run-analyze-all:
	@echo "ğŸŒ Running comprehensive company comparison..."
	uv run python analyze_all_companies.py

# Run analyze_all_companies.py for specific company stats (usage: make run-single-stats COMPANY=ì‚¼ì„±ì „ì)
run-single-stats:
	@echo "ğŸ” Running individual stats for $(COMPANY)..."
	uv run python analyze_all_companies.py --company "$(COMPANY)"

# Generate comprehensive comparison report
run-comprehensive-report:
	@echo "ğŸ“‹ Generating comprehensive company comparison report..."
	uv run python comprehensive_company_comparison_report.py

# Compare dividend yields between common and preferred stocks
run-dividend-compare:
	@echo "ğŸ’° Comparing dividend yields for all companies..."
	uv run python stock_diff.py --dividend-compare

# Compare dividend yields for specific company (usage: make run-dividend-compare-company COMPANY=ì‚¼ì„±ì „ì)
run-dividend-compare-company:
	@echo "ğŸ’° Comparing dividend yields for $(COMPANY)..."
	uv run python stock_diff.py --company "$(COMPANY)" --dividend-compare

# === ë°±í…ŒìŠ¤íŒ… ===

# Run backtest_strategy.py
run-backtest-strategy:
	@echo "ğŸ® Running backtest_strategy_with_report.py..."
	uv run python backtest_strategy_with_report.py

# Run backtest_strategy.py for specific company (usage: make run-backtest-strategy-company COMPANY=ì‚¼ì„±ì „ì)
run-backtest-strategy-company:
	@echo "ğŸ® Running backtest_strategy_with_report.py for $(COMPANY)..."
	uv run python backtest_strategy_with_report.py --company "$(COMPANY)"

# === ê¸°íƒ€ ë„êµ¬ ===

# Run get_samsung_ltd_dividend.py (legacy)
run-get-ltd-dividend:
	@echo "ğŸ’° Running get_samsung_ltd_dividend.py..."
	uv run python get_samsung_ltd_dividend.py

# === ì •ë¦¬ ì‘ì—… ===

# Clean up generated files
clean:
	@echo "ğŸ§¹ Cleaning up generated files..."
	rm -f *_stock_analysis_*.json
	rm -f *_dividend_data.json
	rm -f *.png
	rm -f *.md
	rm -f samsung_stock_analysis.json
	rm -f samsung_ltd_dividends.json

# Clean only chart files
clean-charts:
	@echo "ğŸ§¹ Cleaning up chart files..."
	rm -f *.png

# Clean only data files
clean-data:
	@echo "ğŸ§¹ Cleaning up data files..."
	rm -f *_stock_analysis_*.json
	rm -f *_dividend_data.json
	rm -f *.md

# === ë„ì›€ë§ ===

help:
	@echo "ğŸ“– ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:"
	@echo ""
	@echo "ğŸ¯ ê¸°ë³¸ ì‚¬ìš©ë²•:"
	@echo "  make                                    - ëª¨ë“  íšŒì‚¬ ìë™ ë¶„ì„ (ì „ì²´ íŒŒì´í”„ë¼ì¸)"
	@echo "  make interactive                        - ëŒ€í™”í˜• íšŒì‚¬ ì„ íƒ ë° ë¶„ì„"
	@echo ""
	@echo "ğŸš€ ë°ì´í„° ìƒì„±:"
	@echo "  make run-stock-diff                     - ëª¨ë“  íšŒì‚¬ ë°ì´í„° ìƒì„±"
	@echo "  make run-stock-diff-company COMPANY=íšŒì‚¬ëª…  - íŠ¹ì • íšŒì‚¬ ë°ì´í„° ìƒì„±"
	@echo "  make list-companies                     - ì§€ì› íšŒì‚¬ ëª©ë¡"
	@echo ""
	@echo "ğŸ“Š ê°œë³„ ì‹¬í™” ë¶„ì„ (analyze_ratio.py):"
	@echo "  make run-analyze-ratio                  - ëª¨ë“  íšŒì‚¬ ì „ì²´ ê¸°ê°„ ì¢…í•© ë¶„ì„"
	@echo "  make run-analyze-ratio-company COMPANY=íšŒì‚¬ëª…  - íŠ¹ì • íšŒì‚¬ ì „ì²´ ê¸°ê°„ ì¢…í•© ë¶„ì„"
	@echo "  make run-analyze-single-period PERIOD=ê¸°ê°„    - ëª¨ë“  íšŒì‚¬ íŠ¹ì • ê¸°ê°„ ë¶„ì„"
	@echo "  make run-analyze-company-period COMPANY=íšŒì‚¬ëª… PERIOD=ê¸°ê°„  - íŠ¹ì • íšŒì‚¬ íŠ¹ì • ê¸°ê°„ ë¶„ì„"
	@echo "  make run-timeseries COMPANY=íšŒì‚¬ëª…       - ì‹œê³„ì—´ ê·¸ë˜í”„ ìƒì„±"
	@echo ""
	@echo "ğŸŒ ë‹¤ì¤‘ íšŒì‚¬ ë¹„êµ (analyze_all_companies.py):"
	@echo "  make run-analyze-all                    - ëª¨ë“  íšŒì‚¬ ì¢…í•© ë¹„êµ"
	@echo "  make run-single-stats COMPANY=íšŒì‚¬ëª…     - íŠ¹ì • íšŒì‚¬ í†µê³„ë§Œ"
	@echo "  make run-comprehensive-report           - ì¢…í•© ë¹„êµ ë¦¬í¬íŠ¸ ìƒì„±"
	@echo ""
	@echo "ğŸ’° ë°°ë‹¹ë¥  ë¹„êµ ë¶„ì„:"
	@echo "  make run-dividend-compare               - ëª¨ë“  íšŒì‚¬ ë°°ë‹¹ë¥  ë¹„êµ"
	@echo "  make run-dividend-compare-company COMPANY=íšŒì‚¬ëª…  - íŠ¹ì • íšŒì‚¬ ë°°ë‹¹ë¥  ë¹„êµ"
	@echo ""
	@echo "ğŸ® ë°±í…ŒìŠ¤íŒ…:"
	@echo "  make run-backtest-strategy              - ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰"
	@echo "  make run-backtest-strategy-company COMPANY=íšŒì‚¬ëª…  - íŠ¹ì • íšŒì‚¬ ë°±í…ŒìŠ¤íŒ…"
	@echo ""
	@echo "ğŸš€ ì „ì²´ íŒŒì´í”„ë¼ì¸:"
	@echo "  make run-full-pipeline-company COMPANY=íšŒì‚¬ëª…  - íŠ¹ì • íšŒì‚¬ ì „ì²´ ë¶„ì„"
	@echo "  make run-full-pipeline-all              - ëª¨ë“  íšŒì‚¬ ì „ì²´ ë¶„ì„"
	@echo ""
	@echo "ğŸ§¹ ì •ë¦¬:"
	@echo "  make clean                              - ëª¨ë“  ìƒì„± íŒŒì¼ ì‚­ì œ"
	@echo "  make clean-charts                       - ì°¨íŠ¸ íŒŒì¼ë§Œ ì‚­ì œ"
	@echo "  make clean-data                         - ë°ì´í„° íŒŒì¼ë§Œ ì‚­ì œ"
	@echo ""
	@echo "ì˜ˆì‹œ:"
	@echo "  make                                    # ëª¨ë“  íšŒì‚¬ ìë™ ë¶„ì„"
	@echo "  make interactive                        # ëŒ€í™”í˜• ì„ íƒ"
	@echo "  make run-stock-diff-company COMPANY=ì‚¼ì„±ì „ì"
	@echo "  make run-analyze-ratio-company COMPANY=LGí™”í•™"
	@echo "  make run-analyze-company-period COMPANY=í˜„ëŒ€ìë™ì°¨ PERIOD=10ë…„"
	@echo "  make run-dividend-compare-company COMPANY=í˜„ëŒ€ìë™ì°¨"
	@echo "  make run-comprehensive-report           # ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±"
